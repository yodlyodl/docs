<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>YodlDocs — YodlYodl</title>
  <link rel="icon" href="./yodlyodl.png" />

  <!-- jsPDF + html2canvas for PDF export -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

  <style>
    :root{
      --bg: #000000;
      --fg: #ffdd33; /* dark yellow */
      --muted: #111;
      --accent: #ffdd33;
      --border: 2px solid var(--accent);
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
    }
    html,body{height:100%;}
    body{
      margin:0; background:var(--bg); color:var(--fg); display:flex; height:100vh; overflow:hidden;
    }

    /* Sidebar */
    #sidebar{
      width:260px; min-width:200px; max-width:320px; border-right:var(--border); padding:18px; box-sizing:border-box; display:flex; flex-direction:column; gap:12px;
    }

    header.brand{
      display:flex; align-items:center; gap:10px; margin-bottom:6px;
    }
    header.brand img{ width:34px; height:34px; object-fit:contain; border-radius:6px; }
    header.brand h1{ font-size:18px; margin:0; letter-spacing:0.6px; }

    button.primary{
      background:transparent; color:var(--fg); border:1px solid var(--fg); padding:8px 10px; cursor:pointer; border-radius:6px; font-weight:600;
    }

    #docList{ overflow:auto; padding-right:6px; display:flex; flex-direction:column; gap:8px; }
    .docItem{ display:flex; gap:8px; align-items:center; padding:8px; border:1px solid transparent; border-radius:6px; cursor:pointer; }
    .docItem:hover{ background:var(--muted); border-color:var(--accent); }

    .docItem img.icon{ width:28px; height:28px; border-radius:4px; }
    .docItem .meta{ display:flex; flex-direction:column; }
    .docItem .meta .title{ font-weight:700; color:var(--fg); }
    .docItem .meta .sub{ font-size:12px; color:#e6d87a; opacity:0.8; }

    /* Main editor area */
    #main{ flex:1; display:flex; flex-direction:column; padding:18px; box-sizing:border-box; gap:12px; }

    .topbar{ display:flex; align-items:center; gap:10px; }
    .topbar .controls{ margin-left:auto; display:flex; gap:8px; }

    /* Toolbar */
    .toolbar{ display:flex; gap:6px; padding:8px; border-radius:6px; border:1px solid transparent; }
    .toolbar button{ background:transparent; border:1px solid rgba(255,221,51,0.14); color:var(--fg); padding:8px; border-radius:6px; cursor:pointer; }

    #docTitle{ font-size:20px; font-weight:800; margin:6px 0; outline:none; }
    #docTitle[contenteditable="true"]{ border-bottom:1px dashed rgba(255,221,51,0.12); padding-bottom:4px; }

    #editorWrap{ flex:1; display:flex; flex-direction:column; gap:8px; }
    #editor{
      background:var(--bg); color:var(--fg); border:var(--border); padding:18px; border-radius:6px; height:100%; overflow:auto; caret-color:var(--fg);
    }
    #editor:focus{ box-shadow:0 0 0 4px rgba(255,221,51,0.04); }

    .mutedNote{ color:#e6d87a; opacity:0.8; font-size:13px; }

    /* small responsive */
    @media (max-width:800px){ #sidebar{ display:none; } }

  </style>
</head>
<body>

  <div id="sidebar">
    <div class="brand">
      <img src="./yodlyodl.png" alt="YodlYodl logo">
      <div>
        <h1>YodlYodl</h1>
        <div style="font-size:12px;color:#e6d87a;">YodlDocs</div>
      </div>
    </div>

    <button class="primary" id="newBtn">+ New Document</button>
    <div style="font-size:13px; margin-top:6px;">Your documents</div>
    <div id="docList"></div>
    <div style="flex:1"></div>
    <div class="mutedNote">Drafts save locally in your browser. Upload <code>yodlyodl.png</code> to the same folder for branding.</div>
  </div>

  <div id="main">
    <div class="topbar">
      <div style="display:flex;align-items:center;gap:10px;">
        <div class="toolbar" role="toolbar" aria-label="Formatting toolbar">
          <button onclick="cmd('bold')" title="Bold (Ctrl+B)"><strong>B</strong></button>
          <button onclick="cmd('italic')" title="Italic (Ctrl+I)"><em>I</em></button>
          <button onclick="cmd('underline')" title="Underline (Ctrl+U)"><u>U</u></button>
          <button onclick="formatBlock('H1')" title="Heading 1">H1</button>
          <button onclick="formatBlock('H2')" title="Heading 2">H2</button>
          <button onclick="formatBlock('P')" title="Normal">Normal</button>
          <button onclick="cmd('insertUnorderedList')" title="Bulleted list">• List</button>
          <button onclick="cmd('insertOrderedList')" title="Numbered list">1. List</button>
        </div>
      </div>

      <div class="controls">
        <button id="renameBtn" class="primary">Rename</button>
        <button id="exportBtn" class="primary">Export PDF</button>
        <button id="deleteBtn" class="primary" style="border-color:#ff6666;color:#ff6666;">Delete</button>
      </div>
    </div>

    <div>
      <div id="docTitle" contenteditable="true" aria-label="Document title">Untitled</div>
      <div class="mutedNote">Tip: Click title to edit. Formatting buttons above. Autosaves locally.</div>
    </div>

    <div id="editorWrap">
      <div id="editor" contenteditable="true" spellcheck="true">
        <p>Start writing your document...</p>
      </div>
    </div>
  </div>

<script>
// -------------------- Basic data model & storage --------------------
const STORAGE_KEY = 'yodlyodl_docs_v1';
let docs = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
let currentId = null;

function saveAll(){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(docs));
}

function uid(){ return 'doc_' + Date.now() + '_' + Math.floor(Math.random()*9999); }

// -------------------- UI helpers --------------------
const docListEl = document.getElementById('docList');
const editor = document.getElementById('editor');
const docTitleEl = document.getElementById('docTitle');

function renderDocList(){
  docListEl.innerHTML = '';
  const keys = Object.keys(docs).sort((a,b)=> docs[b].updated - docs[a].updated );
  if(keys.length===0){ const p=document.createElement('div'); p.className='mutedNote'; p.innerText='No documents yet'; docListEl.appendChild(p); return; }
  keys.forEach(id=>{
    const d = docs[id];
    const row = document.createElement('div'); row.className='docItem';
    row.onclick = ()=> openDoc(id);

    const img = document.createElement('img'); img.className='icon'; img.src='./yodlyodl.png'; img.onerror = ()=>{ img.style.display='none'; };
    const meta = document.createElement('div'); meta.className='meta';
    const t = document.createElement('div'); t.className='title'; t.innerText = d.title || 'Untitled';
    const s = document.createElement('div'); s.className='sub'; s.innerText = new Date(d.updated).toLocaleString();
    meta.appendChild(t); meta.appendChild(s);
    row.appendChild(img); row.appendChild(meta);
    docListEl.appendChild(row);
  });
}

function newDoc(){
  const id = uid();
  docs[id] = { title: 'Untitled', content: '<p></p>', created: Date.now(), updated: Date.now() };
  saveAll(); renderDocList(); openDoc(id);
}

function openDoc(id){
  if(!docs[id]) return;
  currentId = id;
  docTitleEl.innerText = docs[id].title;
  editor.innerHTML = docs[id].content;
  editor.focus();
  // visual selection highlight in sidebar
  Array.from(document.querySelectorAll('.docItem')).forEach(el=> el.style.outline='none');
}

function deleteCurrent(){
  if(!currentId) return alert('No document open');
  if(!confirm('Delete this document? This cannot be undone.')) return;
  delete docs[currentId]; saveAll(); currentId=null; renderDocList(); editor.innerHTML=''; docTitleEl.innerText='Untitled';
}

function renameCurrent(){
  if(!currentId) return alert('Open a document first');
  const newTitle = prompt('Rename document:', docs[currentId].title || 'Untitled');
  if(newTitle==null) return; // cancelled
  docs[currentId].title = newTitle.trim() || 'Untitled';
  docs[currentId].updated = Date.now(); saveAll(); renderDocList(); openDoc(currentId);
}

// inline title edit saves on blur
docTitleEl.addEventListener('blur', ()=>{
  if(!currentId) return;
  const newTitle = docTitleEl.innerText.trim() || 'Untitled';
  docs[currentId].title = newTitle; docs[currentId].updated = Date.now(); saveAll(); renderDocList();
});

authorizeKeyboardShortcuts();

// -------------------- Formatting commands --------------------
function cmd(command){
  document.execCommand(command, false, null);
  editor.focus();
}
function formatBlock(tag){
  document.execCommand('formatBlock', false, '<' + tag + '>');
  editor.focus();
}

// -------------------- Autosave --------------------
let autosaveTimer = null;
editor.addEventListener('input', ()=>{
  if(!currentId) return;
  docs[currentId].content = editor.innerHTML;
  docs[currentId].updated = Date.now();
  if(autosaveTimer) clearTimeout(autosaveTimer);
  autosaveTimer = setTimeout(()=>{ saveAll(); renderDocList(); }, 500);
});

// Save title changes as well when Enter pressed in title
docTitleEl.addEventListener('keydown', (e)=>{
  if(e.key==='Enter'){ e.preventDefault(); docTitleEl.blur(); }
});

// -------------------- Export PDF (html2canvas -> jsPDF) --------------------
async function exportPDF(){
  if(!currentId) return alert('Open a document first');
  const wrap = document.createElement('div');
  // clone editor to a clean container for rendering
  wrap.style.padding='24px'; wrap.style.background='#000'; wrap.style.color='#ffdd33';
  wrap.style.width='800px';
  const clone = editor.cloneNode(true);
  clone.style.width='752px'; clone.style.boxSizing='border-box';
  wrap.appendChild(clone);

  document.body.appendChild(wrap);
  const canvas = await html2canvas(wrap, { backgroundColor: '#000', scale: 2 });
  const imgData = canvas.toDataURL('image/png');
  document.body.removeChild(wrap);

  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF({ unit: 'px', format: [canvas.width, canvas.height] });
  pdf.addImage(imgData, 'PNG', 0, 0, canvas.width, canvas.height);
  pdf.save((docs[currentId].title || 'document') + '.pdf');
}

// -------------------- Keyboard shortcuts --------------------
function authorizeKeyboardShortcuts(){
  document.addEventListener('keydown', (e)=>{
    if((e.ctrlKey || e.metaKey) && !e.shiftKey){
      if(e.key.toLowerCase() === 'b'){ e.preventDefault(); cmd('bold'); }
      if(e.key.toLowerCase() === 'i'){ e.preventDefault(); cmd('italic'); }
      if(e.key.toLowerCase() === 'u'){ e.preventDefault(); cmd('underline'); }
      if(e.key.toLowerCase() === 's'){ e.preventDefault(); saveAll(); alert('Saved locally'); }
    }
  });
}

// -------------------- Wire buttons --------------------
document.getElementById('newBtn').addEventListener('click', newDoc);
document.getElementById('exportBtn').addEventListener('click', exportPDF);
document.getElementById('renameBtn').addEventListener('click', renameCurrent);
document.getElementById('deleteBtn').addEventListener('click', deleteCurrent);

// -------------------- Init --------------------
(function init(){
  // if no docs exist, create a starter
  if(Object.keys(docs).length===0){ const id=uid(); docs[id] = { title:'Welcome', content:'<h2>Welcome to YodlDocs</h2><p>Edit this document or create a new one.</p>', created:Date.now(), updated:Date.now() }; saveAll(); }
  renderDocList();
  // open the most recent
  const recent = Object.keys(docs).sort((a,b)=> docs[b].updated - docs[a].updated )[0];
  if(recent) openDoc(recent);
})();

</script>
</body>
</html>
