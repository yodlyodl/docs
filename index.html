<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>YodlDocs — YodlYodl</title>
  <link rel="icon" href="./yodlyodl.png" />

  <!-- html2canvas + jsPDF -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

  <style>
    :root{
      --bg: #000000;
      --fg: #ffdd33; /* dark yellow */
      --muted: #111111;
      --accent: #ffdd33;
      --panel-border: 2px solid var(--accent);
      --radius: 8px;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial, Helvetica;
    }

    html,body{height:100%;}
    body{
      margin:0; background:var(--bg); color:var(--fg); display:flex; height:100vh; overflow:hidden;
    }

    /* small fixed logo in top-left (style A) */
    .site-logo{
      position:fixed; left:18px; top:14px; width:72px; height:72px; z-index:1200; border-radius:8px; object-fit:contain;
      box-shadow: 0 6px 18px rgba(0,0,0,0.6);
    }

    /* layout */
    #sidebar{
      width:260px; min-width:200px; max-width:320px; border-right:var(--panel-border); padding:22px 18px; box-sizing:border-box; display:flex; flex-direction:column; gap:12px;
    }

    header.brand{ display:flex; align-items:center; gap:10px; }
    header.brand h1{ font-size:18px; margin:0; }
    header.brand .sub{ font-size:12px; color:#e6d87a; opacity:0.95; }

    button.primary{
      background:transparent; color:var(--fg); border:1px solid var(--fg); padding:8px 12px; cursor:pointer; border-radius:6px; font-weight:600;
    }

    #docList{ overflow:auto; padding-right:6px; display:flex; flex-direction:column; gap:8px; }
    .docItem{ display:flex; gap:8px; align-items:center; padding:8px; border:1px solid transparent; border-radius:6px; cursor:pointer; }
    .docItem:hover{ background:var(--muted); border-color:var(--accent); }
    .docItem.active{ background:rgba(255,221,51,0.06); border-color:var(--accent); }

    .docItem img.icon{ width:32px; height:32px; border-radius:6px; }
    .docItem .meta{ display:flex; flex-direction:column; }
    .docItem .meta .title{ font-weight:700; color:var(--fg); }
    .docItem .meta .sub{ font-size:12px; color:#e6d87a; opacity:0.75; }

    /* main area */
    #main{ flex:1; display:flex; flex-direction:column; padding:22px; box-sizing:border-box; gap:10px; }
    .topbar{ display:flex; align-items:center; gap:12px; }

    .toolbar{ display:flex; gap:8px; padding:8px; border-radius:6px; }
    .toolbar button{ background:transparent; border:1px solid rgba(255,221,51,0.12); color:var(--fg); padding:8px 10px; border-radius:6px; cursor:pointer; }

    .controls{ margin-left:auto; display:flex; gap:8px; }
    .controls .danger{ border-color:#ff6666; color:#ff6666; }

    #docTitle{ font-size:22px; font-weight:800; margin:6px 0; outline:none; }
    #docTitle[contenteditable="true"]{ border-bottom:1px dashed rgba(255,221,51,0.12); padding-bottom:4px; }

    #editorWrap{ flex:1; display:flex; flex-direction:column; gap:8px; }
    #editor{
      background:var(--bg); color:var(--fg); border:var(--panel-border); padding:18px; border-radius:var(--radius); height:100%; overflow:auto; caret-color:var(--fg);
    }
    #editor:focus{ box-shadow:0 0 0 6px rgba(255,221,51,0.04); }

    .mutedNote{ color:#e6d87a; opacity:0.8; font-size:13px; }

    /* Toast */
    #toast{ position:fixed; right:18px; bottom:18px; background:rgba(0,0,0,0.8); color:var(--fg); border:1px solid rgba(255,221,51,0.12); padding:10px 14px; border-radius:8px; display:none; z-index:2000; }

    /* responsive */
    @media (max-width:900px){ #sidebar{ display:none; } .site-logo{ left:12px; top:8px; width:56px; height:56px; } .toolbar{ flex-wrap:wrap; } }

  </style>
</head>
<body>

  <!-- Small fixed logo; expects ./yodlyodl.png to be uploaded alongside index.html on GitHub Pages -->
  <img src="./yodlyodl.png" alt="YodlYodl logo" class="site-logo" onerror="this.style.display='none'" />

  <div id="sidebar">
    <div class="brand">
      <div>
        <h1></h1>
        <div class="sub">YodlDocs</div>
      </div>
    </div>

    <button class="primary" id="newBtn">+ New Document</button>
    <div style="font-size:13px; margin-top:6px;">Your documents</div>
    <div id="docList"></div>
    <div style="flex:1"></div>
    <div class="mutedNote">Drafts save locally in your browser. Upload <code>yodlyodl.png</code> to the same folder for branding.</div>
  </div>

  <div id="main">
    <div class="topbar">
      <div style="display:flex;align-items:center;gap:10px;">
        <div class="toolbar" role="toolbar" aria-label="Formatting toolbar">
          <button onclick="cmd('bold')" title="Bold (Ctrl+B)"><strong>B</strong></button>
          <button onclick="cmd('italic')" title="Italic (Ctrl+I)"><em>I</em></button>
          <button onclick="cmd('underline')" title="Underline (Ctrl+U)"><u>U</u></button>
          <button onclick="formatBlock('H1')" title="Heading 1">H1</button>
          <button onclick="formatBlock('H2')" title="Heading 2">H2</button>
          <button onclick="formatBlock('P')" title="Normal">Normal</button>
          <button onclick="cmd('insertUnorderedList')" title="Bulleted list">• List</button>
          <button onclick="cmd('insertOrderedList')" title="Numbered list">1. List</button>
        </div>
      </div>

      <div class="controls">
        <button id="renameBtn" class="primary">Rename</button>
        <button id="exportBtn" class="primary">Export PDF</button>
        <button id="deleteBtn" class="primary danger">Delete</button>
      </div>
    </div>

    <div>
      <div id="docTitle" contenteditable="true" aria-label="Document title">Untitled</div>
      <div class="mutedNote">Tip: Click title to edit. Formatting buttons above. Autosaves locally.</div>
    </div>

    <div id="editorWrap">
      <div id="editor" contenteditable="true" spellcheck="true">
        <h2>Welcome to YodlDocs</h2>
        <p>Edit this document or create a new one.</p>
      </div>
    </div>
  </div>

  <div id="toast"></div>

<script>
// -------------------- Data model & storage --------------------
const STORAGE_KEY = 'yodlyodl_docs_v1';
let docs = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
let currentId = null;

function saveAll(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(docs)); }
function uid(){ return 'doc_' + Date.now() + '_' + Math.floor(Math.random()*9999); }

// -------------------- UI elements --------------------
const docListEl = document.getElementById('docList');
const editor = document.getElementById('editor');
const docTitleEl = document.getElementById('docTitle');
const toastEl = document.getElementById('toast');

function showToast(msg, ms=2000){ toastEl.innerText = msg; toastEl.style.display = 'block'; setTimeout(()=>{ toastEl.style.display='none'; }, ms); }

function renderDocList(){
  docListEl.innerHTML = '';
  const keys = Object.keys(docs).sort((a,b)=> docs[b].updated - docs[a].updated );
  if(keys.length===0){ const p=document.createElement('div'); p.className='mutedNote'; p.innerText='No documents yet'; docListEl.appendChild(p); return; }
  keys.forEach(id=>{
    const d = docs[id];
    const row = document.createElement('div'); row.className='docItem';
    if(id===currentId) row.classList.add('active');
    row.onclick = ()=> openDoc(id);

    const img = document.createElement('img'); img.className='icon'; img.src='./yodlyodl.png'; img.onerror = ()=>{ img.style.display='none'; };
    const meta = document.createElement('div'); meta.className='meta';
    const t = document.createElement('div'); t.className='title'; t.innerText = d.title || 'Untitled';
    const s = document.createElement('div'); s.className='sub'; s.innerText = new Date(d.updated).toLocaleString();
    meta.appendChild(t); meta.appendChild(s);
    row.appendChild(img); row.appendChild(meta);
    docListEl.appendChild(row);
  });
}

function newDoc(){
  const id = uid();
  docs[id] = { title: 'Untitled', content: '<p></p>', created: Date.now(), updated: Date.now() };
  saveAll(); renderDocList(); openDoc(id);
}

function openDoc(id){
  if(!docs[id]) return;
  currentId = id;
  docTitleEl.innerText = docs[id].title;
  editor.innerHTML = docs[id].content;
  editor.focus();
  renderDocList();
}

function deleteCurrent(){
  if(!currentId) return showToast('No document open');
  if(!confirm('Delete this document? This cannot be undone.')) return;
  delete docs[currentId]; saveAll(); currentId=null; renderDocList(); editor.innerHTML=''; docTitleEl.innerText='Untitled'; showToast('Deleted');
}

function renameCurrent(){
  if(!currentId) return showToast('Open a document first');
  const newTitle = prompt('Rename document:', docs[currentId].title || 'Untitled');
  if(newTitle==null) return; // cancelled
  docs[currentId].title = newTitle.trim() || 'Untitled';
  docs[currentId].updated = Date.now(); saveAll(); renderDocList(); openDoc(currentId); showToast('Renamed');
}

// Title inline save
docTitleEl.addEventListener('blur', ()=>{
  if(!currentId) return;
  const newTitle = docTitleEl.innerText.trim() || 'Untitled';
  docs[currentId].title = newTitle; docs[currentId].updated = Date.now(); saveAll(); renderDocList(); showToast('Saved');
});

docTitleEl.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ e.preventDefault(); docTitleEl.blur(); } });

// -------------------- Formatting --------------------
function cmd(command){ document.execCommand(command, false, null); editor.focus(); }
function formatBlock(tag){ document.execCommand('formatBlock', false, '<' + tag + '>'); editor.focus(); }

// -------------------- Autosave --------------------
let autosaveTimer = null;
editor.addEventListener('input', ()=>{
  if(!currentId) return;
  docs[currentId].content = editor.innerHTML;
  docs[currentId].updated = Date.now();
  if(autosaveTimer) clearTimeout(autosaveTimer);
  autosaveTimer = setTimeout(()=>{ saveAll(); renderDocList(); showToast('Saved'); }, 700);
});

// -------------------- Export to PDF (styled) --------------------
async function exportPDF(){
  if(!currentId) return showToast('Open a document first');
  showToast('Rendering PDF...');
  // clone editor into a clean container so UI chrome doesn't appear
  const clone = editor.cloneNode(true);
  const wrapper = document.createElement('div');
  wrapper.style.padding='24px';
  wrapper.style.background='white'; // use white background for PDFs
  wrapper.style.color='#000';
  wrapper.style.width='800px';
  wrapper.appendChild(clone);
  document.body.appendChild(wrapper);
  try{
    const canvas = await html2canvas(wrapper, { scale: 2, backgroundColor: '#ffffff' });
    const imgData = canvas.toDataURL('image/png');
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF({ unit:'px', format:[canvas.width, canvas.height] });
    pdf.addImage(imgData, 'PNG', 0, 0, canvas.width, canvas.height);
    pdf.save((docs[currentId].title || 'document') + '.pdf');
    showToast('PDF ready');
  }catch(e){
    console.error(e);
    showToast('PDF error');
  }finally{
    document.body.removeChild(wrapper);
  }
}

// -------------------- Keyboard shortcuts --------------------
document.addEventListener('keydown', (e)=>{
  if((e.ctrlKey || e.metaKey) && !e.shiftKey){
    if(e.key.toLowerCase() === 'b'){ e.preventDefault(); cmd('bold'); }
    if(e.key.toLowerCase() === 'i'){ e.preventDefault(); cmd('italic'); }
    if(e.key.toLowerCase() === 'u'){ e.preventDefault(); cmd('underline'); }
    if(e.key.toLowerCase() === 's'){ e.preventDefault(); saveAll(); showToast('Saved'); }
  }
});

// -------------------- Wire buttons --------------------
document.getElementById('newBtn').addEventListener('click', newDoc);
document.getElementById('exportBtn').addEventListener('click', exportPDF);
document.getElementById('renameBtn').addEventListener('click', renameCurrent);
document.getElementById('deleteBtn').addEventListener('click', deleteCurrent);

// -------------------- Init --------------------
(function init(){
  if(Object.keys(docs).length===0){ const id=uid(); docs[id] = { title:'Welcome', content:'<h2>Welcome to YodlDocs</h2><p>Edit this document or create a new one.</p>', created:Date.now(), updated:Date.now() }; saveAll(); }
  renderDocList();
  const recent = Object.keys(docs).sort((a,b)=> docs[b].updated - docs[a].updated )[0];
  if(recent) openDoc(recent);
})();
</script>
</body>
</html>
